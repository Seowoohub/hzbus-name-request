<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Roblox ë‹‰ë„¤ì„ ì‹ ì²­ (ì„ ì°©ìˆœ)</title>
<style>
/* (ìŠ¤íƒ€ì¼ ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) */
body {
    font-family: 'Arial', sans-serif;
    background-color: #121212;
    color: #ffffff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 50px;
    min-height: 100vh;
    margin: 0;
}

h2 {
    margin-bottom: 20px;
    color: #bb86fc; 
}

.input-group {
    display: flex;
    align-items: center;
    margin-bottom: 10px; 
}

input[type="text"] {
    padding: 10px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #bb86fc; 
    width: 200px;
    margin-right: 10px;
    background-color: #1e1e1e;
    color: #fff;
    transition: border-color 0.2s;
}

input[type="text"]:focus {
    outline: none;
    border-color: #6200ee;
}

button {
    padding: 10px 16px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    background-color: #bb86fc;
    color: #121212; 
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
}

button:hover:not(:disabled) {
    background-color: #9b5de5;
}

button:disabled {
    background-color: #555;
    cursor: not-allowed;
}

#statusMessage {
    color: #f44336; 
    font-size: 14px;
    height: 20px;
    margin-top: 5px;
    text-align: center;
}

#nameListContainer {
    margin-top: 30px;
    width: 260px;
}

#nameListContainer h3 {
    margin-bottom: 10px;
    font-weight: 500;
    color: #bbb;
    border-bottom: 1px solid #333;
    padding-bottom: 5px;
}

ul#nameList {
    list-style: none;
    padding: 0;
    margin: 0;
}

ul#nameList li {
    background-color: #1e1e1e;
    margin-bottom: 8px;
    padding: 10px;
    border-radius: 6px;
    text-align: center;
    word-break: break-all; 
}

#madeBy {
    position: fixed;
    bottom: 10px;
    right: 10px;
    font-size: 12px;
    color: #888;
}
</style>
</head>
<body>

<h2>Roblox ë‹‰ë„¤ì„ ì‹ ì²­</h2>

<div class="input-group">
    <input id="nameInput" type="text" placeholder="ë‹‰ë„¤ì„ (2~15ì)" maxlength="15">
    <button id="submitBtn">ì‹ ì²­</button>
</div>

<div id="statusMessage"></div>

<div id="nameListContainer">
    <h3>ì‹ ì²­ì ëª©ë¡ (ì„ ì°©ìˆœ)</h3>
    <ul id="nameList"></ul>
</div>

<div id="madeBy">Made by Seowoo</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// =========================================================================
// ğŸš¨ ì¤‘ìš”: Firebase ì„¤ì • (databaseURL ì¶”ê°€ë¨)
// =========================================================================
const firebaseConfig = {
    apiKey: "AIzaSyBnZzbGUop9sEOrGSjzBp2dUb-3FBCzWNk",
    authDomain: "hzbus-891e1.firebaseapp.com",
    // ğŸš© Realtime Database ì‚¬ìš©ì„ ìœ„í•´ URLì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.
    databaseURL: "https://hzbus-891e1-default-rtdb.firebaseio.com", 
    projectId: "hzbus-891e1",
    storageBucket: "hzbus-891e1.firebasestorage.app",
    messagingSenderId: "644666053693",
    appId: "1:644666053693:web:d7727b3afa34ec72f90654",
    measurementId: "G-YF0WN2RP0T"
};

// Firebase ì´ˆê¸°í™”
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const applicantsRef = ref(db, "applicants"); 

// DOM ìš”ì†Œ
const nameListEl = document.getElementById("nameList");
const nameInput = document.getElementById("nameInput");
const submitBtn = document.getElementById("submitBtn");
const statusMessageEl = document.getElementById("statusMessage");

const MIN_LENGTH = 2; 
// 12ì‹œê°„ (12 * 60 * 60 * 1000)
const COOLDOWN_MS = 43200000; 

/**
 * ë‚¨ì€ ì‹œê°„ì„ "hhì‹œê°„ mmë¶„ ssì´ˆ" í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
 */
function formatRemainingTime(ms) {
    if (ms <= 0) return "0ì´ˆ";
    
    const totalSeconds = Math.floor(ms / 1000);
    const seconds = totalSeconds % 60;
    const minutes = Math.floor((totalSeconds / 60) % 60);
    const hours = Math.floor(totalSeconds / 3600);

    let timeString = "";
    if (hours > 0) timeString += `${hours}ì‹œê°„ `;
    if (minutes > 0) timeString += `${minutes}ë¶„ `;
    timeString += `${seconds}ì´ˆ`;
    
    return timeString.trim();
}

/**
 * ì œì¶œ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³  ë‚¨ì€ ì‹œê°„ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
 */
function checkSubmissionStatus() {
    // ì €ì¥ëœ ë§ˆì§€ë§‰ ì œì¶œ ì‹œê°„ (ì—†ìœ¼ë©´ 0)
    const lastSubmitTime = parseInt(localStorage.getItem("lastSubmitTime") || "0");
    const currentTime = Date.now();
    
    const timeElapsed = currentTime - lastSubmitTime;
    const remainingTimeMs = COOLDOWN_MS - timeElapsed;

    return {
        canSubmit: remainingTimeMs <= 0,
        remainingTimeMs: Math.max(0, remainingTimeMs)
    };
}

let countdownInterval = null;

function updateButtonAndMessage() {
    const { canSubmit, remainingTimeMs } = checkSubmissionStatus();

    // ì¿¨íƒ€ì„ì´ ì§€ë‚¬ë‹¤ë©´ (ì‹ ì²­ ê°€ëŠ¥)
    if (canSubmit) {
        submitBtn.textContent = "ì‹ ì²­";
        submitBtn.disabled = false;
        nameInput.disabled = false;
        displayStatus("");
        if (countdownInterval) {
            clearInterval(countdownInterval);
            countdownInterval = null;
        }
        return;
    }
    
    // ì¿¨íƒ€ì„ ì¤‘ì´ë¼ë©´ (ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘)
    const remainingTimeStr = formatRemainingTime(remainingTimeMs);
    submitBtn.textContent = "ì¿¨íƒ€ì„";
    submitBtn.disabled = true;
    nameInput.disabled = true;
    displayStatus(`â³ ë‹¤ìŒ ì‹ ì²­ê¹Œì§€ ${remainingTimeStr} ë‚¨ì•˜ìŠµë‹ˆë‹¤.`, false, '#ffc107');
    
    // ì¹´ìš´íŠ¸ë‹¤ìš´ ì¸í„°ë²Œì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ì‹œì‘ (1ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸)
    if (!countdownInterval) {
        countdownInterval = setInterval(updateButtonAndMessage, 1000);
    }
}


function displayStatus(message, isSuccess = false, color = null) {
    statusMessageEl.textContent = message;
    if (color) {
        statusMessageEl.style.color = color;
    } else {
        statusMessageEl.style.color = isSuccess ? '#00e676' : '#f44336';
    }
}

async function submitName() {
    const name = nameInput.value.trim();
    
    // 1. ê¸°ë³¸ ìœ íš¨ì„± ê²€ì‚¬
    if (!name) {
        displayStatus("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”!");
        return;
    }
    if (name.length < MIN_LENGTH || name.length > 15) {
        displayStatus(`ë‹‰ë„¤ì„ì€ ${MIN_LENGTH}ì ì´ìƒ, 15ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
        return;
    }

    // 2. ì¿¨íƒ€ì„ ê²€ì‚¬
    if (!checkSubmissionStatus().canSubmit) {
        updateButtonAndMessage();
        return;
    }

    // 3. ì œì¶œ ì²˜ë¦¬
    submitBtn.textContent = "ì‹ ì²­ ì¤‘...";
    submitBtn.disabled = true;
    displayStatus(""); 

    try {
        await push(applicantsRef, { 
            name: name,
            timestamp: Date.now() // ì„ ì°©ìˆœ ì •ë ¬ì„ ìœ„í•œ íƒ€ì„ìŠ¤íƒ¬í”„
        });

        // ì„±ê³µ: ë§ˆì§€ë§‰ ì œì¶œ ì‹œê°„ ì—…ë°ì´íŠ¸ ë° UI ê°±ì‹ 
        localStorage.setItem("lastSubmitTime", Date.now());
        nameInput.value = "";
        displayStatus("âœ… ë‹‰ë„¤ì„ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! 12ì‹œê°„ í›„ì— ë‹¤ì‹œ ì‹ ì²­ ê°€ëŠ¥í•©ë‹ˆë‹¤.", true);
        
        // ì¿¨íƒ€ì„ UI ì‹œì‘
        updateButtonAndMessage();
        
    } catch (err) {
        // ì‹¤íŒ¨
        console.error("Firebase ì˜¤ë¥˜:", err);
        displayStatus("ğŸš¨ ì‹ ì²­ ì‹¤íŒ¨: ì„œë²„ ì˜¤ë¥˜ ë˜ëŠ” ê¶Œí•œ ë¬¸ì œ.");
        // ì‹¤íŒ¨í•˜ë©´ ë²„íŠ¼ í™œì„±í™”
        submitBtn.textContent = "ì‹ ì²­";
        submitBtn.disabled = false;
        nameInput.disabled = false;
    }
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
submitBtn.addEventListener("click", submitName);
nameInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !submitBtn.disabled) submitName();
});

// í˜ì´ì§€ ë¡œë“œ ì‹œ ì¿¨íƒ€ì„ ìƒíƒœ í™•ì¸ ë° ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
document.addEventListener("DOMContentLoaded", updateButtonAndMessage);


// ì‹¤ì‹œê°„ ì‹ ì²­ì ë¦¬ìŠ¤íŠ¸ í‘œì‹œ ë° ì„ ì°©ìˆœ ì •ë ¬
onValue(applicantsRef, (snapshot) => {
    nameListEl.innerHTML = "";
    if (!snapshot.exists()) {
        const li = document.createElement("li");
        li.textContent = "ì•„ì§ ì‹ ì²­ìê°€ ì—†ìŠµë‹ˆë‹¤.";
        nameListEl.appendChild(li);
        return;
    }
    
    const applicants = [];
    snapshot.forEach((child) => {
        applicants.push(child.val());
    });
    
    // ğŸŸ¢ ì„ ì°©ìˆœ ì •ë ¬: íƒ€ì„ìŠ¤íƒ¬í”„ ì˜¤ë¦„ì°¨ìˆœ (ì‘ì€ ê°’ = ë¨¼ì € ì‹ ì²­)
    applicants.sort((a, b) => a.timestamp - b.timestamp); 

    applicants.forEach((applicant) => {
        const li = document.createElement("li");
        li.textContent = applicant.name;
        nameListEl.appendChild(li);
    });
});
</script>

</body>
</html>
