<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Roblox ë‹‰ë„¤ì„ ì‹ ì²­ (ì„ ì°©ìˆœ)</title>
<style>
/* (ìŠ¤íƒ€ì¼ ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) */
body {
    font-family: 'Arial', sans-serif;
    background-color: #121212;
    color: #ffffff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 50px;
    min-height: 100vh;
    margin: 0;
}

h2 {
    margin-bottom: 20px;
    color: #bb86fc; 
}

.input-group {
    display: flex;
    align-items: center;
    margin-bottom: 10px; 
}

input[type="text"] {
    padding: 10px;
    font-size: 16px;
    border-radius: 6px;
    border: 1px solid #bb86fc; 
    width: 200px;
    margin-right: 10px;
    background-color: #1e1e1e;
    color: #fff;
    transition: border-color 0.2s;
}

input[type="text"]:focus {
    outline: none;
    border-color: #6200ee;
}

button {
    padding: 10px 16px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    background-color: #bb86fc;
    color: #121212; 
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
}

button:hover:not(:disabled) {
    background-color: #9b5de5;
}

button:disabled {
    background-color: #555;
    cursor: not-allowed;
}

#statusMessage {
    color: #f44336; 
    font-size: 14px;
    height: 20px;
    margin-top: 5px;
    text-align: center;
}

#nameListContainer {
    margin-top: 30px;
    width: 400px; /* ìˆ˜ì •ëœ ë„ˆë¹„ ìœ ì§€ */
}

#nameListContainer h3 {
    margin-bottom: 10px;
    font-weight: 500;
    color: #bbb;
    border-bottom: 1px solid #333;
    padding-bottom: 5px;
}

ul#nameList {
    list-style: none;
    padding: 0;
    margin: 0;
}

ul#nameList li {
    background-color: #1e1e1e;
    margin-bottom: 8px;
    padding: 10px;
    border-radius: 6px;
    text-align: left; 
    word-break: break-all; 
    line-height: 1.5; 
}

#madeBy {
    position: fixed;
    bottom: 10px;
    right: 10px;
    font-size: 12px;
    color: #888;
}
</style>
</head>
<body>

<h2>Roblox ë‹‰ë„¤ì„ ì‹ ì²­</h2>

<div class="input-group">
    <input id="robloxNameInput" type="text" placeholder="ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„ (2~15ì)" maxlength="15">
</div>

<div class="input-group">
    <input id="kakaoNameInput" type="text" placeholder="ì¹´í†¡ ë‹‰ë„¤ì„ (2~15ì)" maxlength="15">
    <button id="submitBtn">ì‹ ì²­</button>
</div>

<div id="statusMessage"></div>

<div id="nameListContainer">
    <h3>ì‹ ì²­ì ëª©ë¡ (ì„ ì°©ìˆœ)</h3>
    <ul id="nameList"></ul>
</div>

<div id="madeBy">Made by Seowoo</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyBnZzbGUop9sEOrGSjzBp2dUb-3FBCzWNk",
    authDomain: "hzbus-891e1.firebaseapp.com",
    databaseURL: "https://hzbus-891e1-default-rtdb.firebaseio.com",
    projectId: "hzbus-891e1",
    storageBucket: "hzbus-891e1.firebasestorage.app",
    messagingSenderId: "644666053693",
    appId: "1:644666053693:web:d7727b3afa34ec72f90654",
    measurementId: "G-YF0WN2RP0T"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const applicantsRef = ref(db, "applicants"); 

// DOM
const nameListEl = document.getElementById("nameList");
const robloxNameInput = document.getElementById("robloxNameInput");
const kakaoNameInput = document.getElementById("kakaoNameInput");
const submitBtn = document.getElementById("submitBtn");
const statusMessageEl = document.getElementById("statusMessage");

const MIN_LENGTH = 2;
const MAX_LENGTH = 15;
const COOLDOWN_MS = 43200000; // 12ì‹œê°„

function formatRemainingTime(ms) {
    if (ms <= 0) return "0ì´ˆ";
    const totalSeconds = Math.floor(ms / 1000);
    const seconds = totalSeconds % 60;
    const minutes = Math.floor((totalSeconds / 60) % 60);
    const hours = Math.floor(totalSeconds / 3600);
    let t = "";
    if (hours > 0) t += `${hours}ì‹œê°„ `;
    if (minutes > 0) t += `${minutes}ë¶„ `;
    t += `${seconds}ì´ˆ`;
    return t.trim();
}

function checkSubmissionStatus() {
    const last = parseInt(localStorage.getItem("lastSubmitTime") || "0");
    const now = Date.now();
    const diff = now - last;
    const remain = COOLDOWN_MS - diff;
    return { canSubmit: remain <= 0, remain: Math.max(0, remain) };
}

let timer = null;

function updateButton() {
    const { canSubmit, remain } = checkSubmissionStatus();
    if (canSubmit) {
        submitBtn.textContent = "ì‹ ì²­";
        submitBtn.disabled = false;
        robloxNameInput.disabled = false;
        kakaoNameInput.disabled = false;
        displayStatus("");
        clearInterval(timer);
        timer = null;
    } else {
        submitBtn.textContent = "ì¿¨íƒ€ì„";
        submitBtn.disabled = true;
        robloxNameInput.disabled = true;
        kakaoNameInput.disabled = true;
        displayStatus(`â³ ë‹¤ìŒ ì‹ ì²­ê¹Œì§€ ${formatRemainingTime(remain)} ë‚¨ì•˜ìŠµë‹ˆë‹¤.`, false, '#ffc107');
        if (!timer) timer = setInterval(updateButton, 1000);
    }
}

function displayStatus(msg, ok = false, color = null) {
    statusMessageEl.textContent = msg;
    statusMessageEl.style.color = color || (ok ? '#00e676' : '#f44336');
}

async function submitName() {
    const robloxName = robloxNameInput.value.trim();
    const kakaoName = kakaoNameInput.value.trim();

    if (!robloxName || !kakaoName) {
        displayStatus("ë¡œë¸”ë¡ìŠ¤ ë‹‰ë„¤ì„ê³¼ ì¹´í†¡ ë‹‰ë„¤ì„ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!");
        return;
    }

    if (
        robloxName.length < MIN_LENGTH || 
        robloxName.length > MAX_LENGTH || 
        kakaoName.length < MIN_LENGTH || 
        kakaoName.length > MAX_LENGTH
    ) {
        displayStatus(`ë‹‰ë„¤ì„ì€ ${MIN_LENGTH}ì ì´ìƒ, ${MAX_LENGTH}ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.`);
        return;
    }

    if (!checkSubmissionStatus().canSubmit) {
        updateButton();
        return;
    }

    submitBtn.textContent = "ì‹ ì²­ ì¤‘...";
    submitBtn.disabled = true;
    displayStatus("");

    try {
        await push(applicantsRef, {
            robloxName,
            kakaoName,
            timestamp: Date.now()
        });

        localStorage.setItem("lastSubmitTime", Date.now());
        robloxNameInput.value = "";
        kakaoNameInput.value = "";
        displayStatus("âœ… ì‹ ì²­ ì™„ë£Œ! 12ì‹œê°„ í›„ ë‹¤ì‹œ ì‹ ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.", true);
        updateButton();

    } catch (err) {
        console.error("Firebase ì˜¤ë¥˜:", err);
        displayStatus("ğŸš¨ ì‹ ì²­ ì‹¤íŒ¨: ì„œë²„ ì˜¤ë¥˜ ë˜ëŠ” ê¶Œí•œ ë¬¸ì œ.");
        submitBtn.textContent = "ì‹ ì²­";
        submitBtn.disabled = false;
        robloxNameInput.disabled = false;
        kakaoNameInput.disabled = false;
    }
}

submitBtn.addEventListener("click", submitName);
robloxNameInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !submitBtn.disabled) submitName();
});
kakaoNameInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !submitBtn.disabled) submitName();
});

document.addEventListener("DOMContentLoaded", updateButton);

// ğŸš© ëª©ë¡ ê°±ì‹  ë¡œì§ì„ ë” ê²¬ê³ í•˜ê²Œ ìˆ˜ì •
onValue(applicantsRef, (snapshot) => {
    nameListEl.innerHTML = "";
    if (!snapshot.exists()) {
        const li = document.createElement("li");
        li.textContent = "ì•„ì§ ì‹ ì²­ìê°€ ì—†ìŠµë‹ˆë‹¤.";
        nameListEl.appendChild(li);
        return;
    }

    const applicants = [];
    // ğŸš© ë°ì´í„°ë¥¼ ë°°ì—´ë¡œ ë³€í™˜
    snapshot.forEach((childSnapshot) => {
        applicants.push(childSnapshot.val());
    });
    
    // íƒ€ì„ìŠ¤íƒ¬í”„ ìˆœìœ¼ë¡œ ì •ë ¬
    applicants.sort((a, b) => a.timestamp - b.timestamp);

    // ëª©ë¡ì— í‘œì‹œ
    applicants.forEach(({ robloxName, kakaoName }) => {
        const li = document.createElement("li");
        li.innerHTML = `<strong>ë¡œë¸”ë¡ìŠ¤:</strong> ${robloxName} <br><strong>ì¹´í†¡:</strong> ${kakaoName}`;
        nameListEl.appendChild(li);
    });
});
</script>

</body>
</html>
